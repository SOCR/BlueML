test_arr = [0.07183776, 0.09324765, 0.13643287, 0.1812148 , 0.0544761 ,
       0.08340946, 0.10647403, 0.11531641, 0.13376555, 0.09599325,
       0.09875661, 0.14601448, 0.07381603, 0.10772127, 0.11950099,
       0.07634172, 0.13236225, 0.08157925, 0.06591644, 0.16411357,
       0.09302504, 0.12824054, 0.0572651 , 0.13885988, 0.08392503,
       0.04852179, 0.13333109, 0.09164647, 0.16143734, 0.21542984,
       0.09243712, 0.1093573 , 0.18108961, 0.08241066, 0.01103172,
       0.10858683, 0.09309053, 0.12695464, 0.14150364, 0.03030814,
       0.12354342, 0.11459512, 0.30946618, 0.05070273, 0.23630307,
       0.22299696, 0.15112807, 0.11366457, 0.06550411, 0.09855391,
       0.08825146, 0.08482613, 0.1416782 , 0.04028364, 0.18467616,
       0.22246828, 0.15346269, 0.14361678, 0.17061986, 0.02303513,
       0.12652137, 0.06356341, 0.14928353, 0.05589603, 0.19075453,
       0.0875504 , 0.10980498, 0.10150075, 0.0488882 , 0.22077798,
       0.15807591, 0.13498631, 0.13059461, 0.11958309, 0.09968797,
       0.09489138, 0.0456141 , 0.07507499, 0.03283924, 0.24896726,
       0.31375996, 0.15342892, 0.07273538, 0.108994  , 0.13944342,
       0.11885164, 0.00729685, 0.03974915, 0.13521715, 0.05216718,
       0.07659944, 0.09485059, 0.10912315, 0.13165585, 0.26288045,
       0.09347484, 0.09669286, 0.12682397, 0.10854976, 0.09514377,
       0.03441495, 0.13208536, 0.18420841, 0.05968005, 0.11461387,
       0.146787  , 0.04235365, 0.25605865, 0.13219674, 0.13594417,
       0.15067856, 0.20800408, 0.14345281, 0.1214907 , 0.02108641,
       0.06007185, 0.13033977, 0.06553953, 0.07059219, 0.10425222,
       0.00966972, 0.0190278 , 0.04776174, 0.05257216, 0.18789502,
       0.06328968, 0.28155729, 0.0790293 , 0.18633543, 0.23554406,
       0.16829261, 0.20443959, 0.0323102 , 0.10317118, 0.05306428,
       0.09233805, 0.22273576, 0.07899456, 0.15506813, 0.04558448,
       0.08523695, 0.22618544, 0.09802958, 0.02670179, 0.17756923,
       0.14246964, 0.15790241, 0.03388813, 0.05278463, 0.03664444,
       0.17341816, 0.18911382, 0.09344211, 0.15665084, 0.17352662,
       0.17566491, 0.02707579, 0.15156791, 0.08423354, 0.05983458,
       0.14232929, 0.06258514, 0.20860145, 0.21823276, 0.11191531,
       0.20888475, 0.10619963, 0.12961912, 0.08201689, 0.16936287,
       0.20687619, 0.11063706, 0.05725287, 0.19720233, 0.08017438,
       0.07697926, 0.20556012, 0.14692765, 0.07098788, 0.16057509,
       0.08374324, 0.02458638, 0.14273919, 0.18199625, 0.07441796,
       0.19115708, 0.03536544, 0.19727774, 0.08320164, 0.18152667,
       0.08481082, 0.27705513, 0.31899428, 0.10013219, 0.05918716,
       0.19238732, 0.13916302, 0.17657775, 0.07504927, 0.12064895,
       0.09576304, 0.31083724, 0.03614586, 0.18304781, 0.24819936,
       0.27496603, 0.17488053, 0.09909795, 0.21575783, 0.11384782,
       0.11933723, 0.11593458, 0.19455477, 0.17467306, 0.03472468,
       0.09922066, 0.06193473, 0.26324197, 0.18395982, 0.07230882,
       0.22330719, 0.09271464, 0.16096449, 0.13804986, 0.107056  ,
       0.13023746, 0.09599089, 0.09472839, 0.11056676, 0.16551995,
       0.16490343, 0.17434949, 0.08820454, 0.28092114, 0.14485659,
       0.04868313, 0.12845377, 0.19506489, 0.11977087, 0.12196761,
       0.3610478 , 0.25758484, 0.15689346, 0.09326093, 0.16047544,
       0.04970831, 0.10152832, 0.12657607, 0.04583284, 0.16978969,
       0.01723088, 0.03341804, 0.15090874, 0.11761119, 0.08246277,
       0.28208401, 0.16273873, 0.12939608, 0.04587494, 0.08976339,
       0.0818422 , 0.20599487, 0.18966141, 0.19115855, 0.20876453,
       0.31642436, 0.24331333, 0.03326548, 0.08947607, 0.181258  ,
       0.10066931, 0.04031947, 0.18730115, 0.12025262, 0.03872195,
       0.12606498, 0.12688509, 0.04916169, 0.28735083, 0.16019543,
       0.12225943, 0.15520126, 0.06770439, 0.10104388, 0.16284012,
       0.23648401, 0.11255606, 0.07687923, 0.15767789, 0.06645609,
       0.10683684, 0.1350471 , 0.13930958, 0.30039768, 0.24554416,
       0.03558115, 0.22328062, 0.15934431, 0.10814427, 0.20327122,
       0.0682742 , 0.11602282, 0.02206501, 0.20864517, 0.06101708,
       0.15706799, 0.19120029, 0.15117959, 0.20261452, 0.23613212,
       0.16637192, 0.13502188, 0.10838611, 0.02787318, 0.13221036,
       0.06479378, 0.1586294 , 0.20007048, 0.0208268 , 0.28736985,
       0.1960209 , 0.21489758, 0.26195695, 0.17150019, 0.20694455,
       0.10967625, 0.11205553, 0.16776429, 0.23527892, 0.17589393,
       0.12447021, 0.11164351, 0.13923666, 0.20307945, 0.01570537,
       0.06337881, 0.13284308, 0.08191709, 0.29211714, 0.4465859 ,
       0.01107288, 0.09144824, 0.07146228, 0.10893715, 0.14756366,
       0.24008766, 0.25039128, 0.28405716, 0.21613873, 0.12009801,
       0.05795168, 0.18027204, 0.08628509, 0.12444269, 0.0622269 ,
       0.02891   , 0.06679114, 0.09226485, 0.23831662, 0.06612258,
       0.18396115, 0.06134146, 0.21923169, 0.09654839, 0.08975378,
       0.26011419, 0.17591283, 0.24027523, 0.14731483, 0.06985789,
       0.1093957 , 0.05863384, 0.23178084, 0.14856778, 0.139264  ,
       0.44040379, 0.20253322, 0.33799468, 0.47258505, 0.51033808,
       0.31259228, 0.20986505, 0.56706368, 0.21418068, 0.24611243,
       0.19820789, 0.25523371, 0.54544576, 0.34634693, 0.10795348,
       0.37178457, 0.47020764, 0.39992909, 0.43186435, 0.31436282,
       0.48955329, 0.4344347 , 0.13728435, 0.44464834, 0.21514328,
       0.07152085, 0.09334316, 0.13634546, 0.1816707 , 0.05501887,
       0.08282797, 0.10602979, 0.11613254, 0.13289299, 0.09643828,
       0.09977918, 0.14613847, 0.07248901, 0.10893701, 0.11924697,
       0.07797648, 0.13094028, 0.08320512, 0.06454583, 0.16415892,
       0.09379525, 0.12592522, 0.05794102, 0.13794881, 0.08619973,
       0.04583712, 0.13046126, 0.08898087, 0.16433947, 0.21333336,
       0.09571008, 0.1102459 , 0.17963464, 0.08144942, 0.00735066,
       0.11190935, 0.09556206, 0.12986201, 0.14548058, 0.02872247,
       0.1266095 , 0.11896814, 0.30542068, 0.05536892, 0.23460688,
       0.21831524, 0.14839005, 0.11674922, 0.07073167, 0.0954572 ,
       0.08530935, 0.08945577, 0.14453582, 0.03454996, 0.18134119,
       0.21676326, 0.1590364 , 0.14133025, 0.17361117, 0.0278897 ,
       0.13074358, 0.06742057, 0.14663346, 0.05069562, 0.18431028,
       0.08677495, 0.10660326, 0.10787826, 0.05447961, 0.22650279,
       0.1507012 , 0.14199545, 0.12535541, 0.11162181, 0.10204505,
       0.09665052, 0.05318403, 0.07902915, 0.02911963, 0.24469723,
       0.30382705, 0.1529782 , 0.06407789, 0.10443963, 0.13984557,
       0.11780226, 0.01058105, 0.04500484, 0.12455687, 0.04226203,
       0.07858626, 0.08572117, 0.11592962, 0.13017768, 0.24860048,
       0.08989737, 0.09426085, 0.13165736, 0.10250321, 0.10142757,
       0.0380974 , 0.11733828, 0.17238217, 0.04628073, 0.10000004,
       0.13328777, 0.04801176, 0.23735407, 0.12212176, 0.11366782,
       0.14461786, 0.1784893 , 0.13511786, 0.1105467 , 0.01935468,
       0.04726814, 0.11560903, 0.06120683, 0.05210603, 0.08975379,
       0.00513132, 0.00739219, 0.04582098, 0.0419498 , 0.13170752,
       0.03988649, 0.20275385, 0.04780141, 0.12696095, 0.16549404,
       0.12068989, 0.14171486, 0.01381208, 0.05619453, 0.03605457,
       0.06006822, 0.13296645, 0.04681361, 0.09380399, 0.02304318,
       0.05229238, 0.11389048, 0.05238961, 0.01173685, 0.08552561,
       0.05919315, 0.07476485, 0.01809002, 0.02565271, 0.02013999,
       0.06831613, 0.07927221, 0.03058401, 0.05521985, 0.0572827 ,
       0.05585569, 0.01433435, 0.05575696, 0.02908327, 0.01357757,
       0.03789201, 0.02289184, 0.05494523, 0.05901654, 0.03411265,
       0.05329314, 0.03076415, 0.03340951, 0.0242446 , 0.04055665,
       0.05099414, 0.02247593, 0.01669788, 0.04054933, 0.01794744,
       0.01910079, 0.03659207, 0.02556955, 0.01613411, 0.02708688,
       0.01827265, 0.00762036, 0.02002075, 0.02848515, 0.00828032,
       0.02557674, 0.00859475, 0.03058379, 0.00889037, 0.02422862,
       0.01322447, 0.03287594, 0.04280147, 0.00960295, 0.00934046,
       0.02550849, 0.01366481, 0.01827086, 0.00662427, 0.01567757]

require('@tensorflow/tfjs-node')
require('async')

const wf = require('wavefile')
const tf = require('@tensorflow/tfjs')
const fs = require('fs')

const json_file = fs.readFileSync('python/config.json', 'utf8');
const config = JSON.parse(json_file);

const MODEL_PATH = 'file://' + config.config.output.output_dir + 'tensorflowjs_model.pb';
const WEIGHTS_PATH = 'file://' + config.config.output.output_dir + 'weights_manifest.json';

const TEST_PATH = 'data/training-f/f0001.wav';

console.log("Loading model from " + MODEL_PATH);
console.log("Loading weights from " + WEIGHTS_PATH);

async function predict_preloadmodel() {
   var test = tf.tensor(test_arr);
   var test = test.reshape([-1,600]);
   
    /*let x = new wf(fs.readFileSync(TEST_PATH));
    console.log(x['length'])
    for (var member in x) delete x[member];
    x['input/X'] = '1';
    x['input/drop'] = '2';*/

    const model = await tf.loadFrozenModel(MODEL_PATH, WEIGHTS_PATH);
    await model.predict(test).print();
}

predict_preloadmodel();